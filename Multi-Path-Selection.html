<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>S&R Truck Quote Builder</title>

<style>
.hidden {
  display: none;
}
body {
  font-family: system-ui, sans-serif;
  background: #f7f9fc;
  margin: 0;
  padding: 2rem;
}
.container {
  max-width: 900px;
  margin: 0 auto;
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}
h1 {
  text-align: center;
  color: #1a202c;
  margin-bottom: 1.5rem;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 2rem;
  background: #f9fafb;
}
th, td {
  border: 1px solid #e2e8f0;
  padding: 0.75rem;
  text-align: left;
  vertical-align: middle;
}
th {
  background: #2563eb;
  color: white;
  text-align: center;
}
tr:nth-child(even) td {
  background: #f1f5f9;
}
td[contenteditable="true"]:focus {
  outline: 2px solid #2563eb;
  background: #eef2ff;
}
tfoot td {
  font-weight: bold;
  background: #e0e7ff;
}
.actions {
  text-align: center;
  white-space: nowrap;
  width: 100px;
}
.action-btn {
  display: inline-block;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  line-height: 1;
  margin: 0 2px;
  width: 32px;
  height: 28px;
  transition: all 0.15s ease;
}
.action-btn.add {
  background-color: #e5e7eb;
  color: #4b5563;
}
.action-btn.add:hover {
  background-color: #cbd5e1;
}
.action-btn.delete {
  background-color: #ef4444;
  color: white;
}
.action-btn.delete:hover {
  background-color: #dc2626;
}
.dragging {
  opacity: 0.6;
  background-color: #dbeafe !important;
}
button.primary {
  margin-top: 1rem;
  width: 100%;
  background-color: #2563eb;
  color: white;
  border: none;
  padding: 0.8rem;
  font-size: 1.1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease-in-out;
}
button.primary:hover {
  background-color: #1d4ed8;
}
#message {
  text-align: center;
  color: #16a34a;
  font-weight: 600;
  margin-top: 1rem;
  display: none;
}
#saveControls {
  margin-top: 1rem;
  display: flex;
  gap: 10px;
  flex-direction: column;
}
#savedQuotesPanel {
  display:none;
  margin-top: 1rem;
  background:white;
  padding:15px;
  border:1px solid #ddd;
  border-radius:8px;
}
.saved-item {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px;
  margin-bottom:6px;
  background:#f7f7f7;
  border-radius:6px;
}
.saved-item button {
  background:#ef4444;
  color:white;
  border:none;
  padding:4px 8px;
  border-radius:5px;
  cursor:pointer;
}
.saved-item button:hover {
  background:#dc2626;
}
.saved-item .meta {
  font-size: 12px;
  color: #666;
  margin-left: 8px;
}
.row-actions {
  display:flex;
  gap:8px;
  align-items:center;
}
#startSelection {
  text-align:center;
  margin-bottom:1rem;
}
.question-row {
  margin-bottom: 12px;
}
.question-label {
  display: inline-block;
  width: 260px;
}
@media (max-width: 480px) {
  .action-btn { width: 28px; height: 26px; font-size: 0.8rem; }
  .actions { width: 86px; }
  .container { padding: 1rem; }
  .question-label { width: 100%; margin-bottom: 4px; }
  .question-row select { width: 100%; }
}
</style>
</head>

<body>
<div class="container">
  <h1>SR Truck Quote Builder</h1>

  <!-- Multi-Path Selection -->
  <div id="startSelection">
    <button class="primary" onclick="startBlankQuote()">Start Blank Quote</button>
    <button class="primary" onclick="loadConfiguratorQuestions()">Truck Configurator Questions</button>
  </div>

  <!-- Truck Configurator Questions UI -->
  <div id="configuratorContainer" class="hidden" style="margin-top:20px;">
    <h2>Body Options</h2>
    <div id="questionsArea">

      <!-- These will be auto-populated -->
      <div class="question-row">
        <label class="question-label" for="Body-Series">Body Series:</label>
        <select id="Body-Series"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Body-Length">Body Length:</label>
        <select id="Body-Length"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Side-Ht-F">Side Ht. F:</label>
        <select id="Side-Ht-F"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Side-Ht-R">Side Ht. R:</label>
        <select id="Side-Ht-R"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Doghouse-Depth">Doghouse Depth:</label>
        <select id="Doghouse-Depth"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Extra-Ovals-Rear">Extra Ovals in Rear:</label>
        <select id="Extra-Ovals-Rear"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Door-Slope">Door Slope:</label>
        <select id="Door-Slope"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Hi-Lift-Tailgate">Hi-Lift Tailgate:</label>
        <select id="Hi-Lift-Tailgate"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Coal-Door">Coal Door:</label>
        <select id="Coal-Door"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Twistlocks">Twistlocks:</label>
        <select id="Twistlocks"></select>
      </div>

      <div class="question-row">
        <label class="question-label" for="Light-Kit">Light Kit:</label>
        <select id="Light-Kit"></select>
      </div>

      <!-- FIXED VALUES -->
      <div class="question-row">
        <label class="question-label" for="Bumper">Bumper:</label>
        <input id="Bumper" type="text" readonly />
      </div>

      <div class="question-row">
        <label class="question-label" for="Vibrator-Plate">Vibrator Plate:</label>
        <input id="Vibrator-Plate" type="text" readonly />
      </div>

      <div class="question-row">
        <label class="question-label" for="Inside-Steps">Inside Steps:</label>
        <input id="Inside-Steps" type="text" readonly />
      </div>

      <div class="question-row">
        <label class="question-label" for="Side-Plate">Side Plate:</label>
        <input id="Side-Plate" type="text" readonly />
      </div>

      <div class="question-row">
        <label class="question-label" for="Tailgate-Cylinder">Tailgate Cylinder:</label>
        <input id="Tailgate-Cylinder" type="text" readonly />
      </div>

      <div class="question-row">
        <label class="question-label" for="Body-Prop">Body Prop:</label>
        <input id="Body-Prop" type="text" readonly />
      </div>

    </div>
  </div>

  <!-- Save / Import Controls -->
  <div id="saveControls">
    <div style="display:flex; gap:8px; align-items:center;">
      <input type="text" id="quoteName" placeholder="Quote name" style="flex:1; padding:8px; display:block;">
      <button class="primary" type="button" onclick="saveQuote()">üíæ Save Quote</button>
    </div>

    <div style="display:flex; gap:8px; margin-top:8px;">
      <button class="primary" type="button" onclick="toggleSavedQuotesPanel()">üìÅ Saved Quotes</button>
      <button class="primary" type="button" onclick="importQuoteHTML()">‚¨áÔ∏è Import HTML Quote</button>
    </div>
  </div>

  <!-- Quote Table -->
  <div id="quoteSection" style="display:none; margin-top:2rem;">
    <table id="quoteTable" aria-label="Quote table">
      <thead>
        <tr>
          <th>Description of Work to be Performed</th>
          <th>Total $</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody id="quoteBody">
        <tr draggable="true">
          <td contenteditable="true" placeholder="Enter description..." spellcheck="false"></td>
          <td contenteditable="true" onblur="formatCurrency(this)" oninput="updateTotal()" placeholder="Enter amount..." spellcheck="false"></td>
          <td class="actions">
            <button class="action-btn add" title="Insert row below" onclick="insertRow(this)">+</button>
            <button class="action-btn delete" title="Delete row" onclick="deleteRow(this)">üóë</button>
          </td>
        </tr>
      </tbody>

      <tfoot>
        <tr>
          <td style="text-align:right;">Total Amount:</td>
          <td id="grandTotal">$0.00</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <button class="primary" type="button" onclick="copyQuoteHTML()">üìã Copy Quote to Striven</button>
    <div id="message">Quote copied ‚Äî paste it into Striven!</div>
  </div>

  <!-- Saved Quotes Panel -->
  <div id="savedQuotesPanel">
    <h3>Saved Quotes</h3>
    <div id="savedQuotesList"></div>
  </div>
</div>

<script>
/* MULTI-PATH LOGIC */
function startBlankQuote() {
  document.getElementById('quoteSection').style.display = 'block';
}

/* CONFIGURATOR QUESTIONS */
async function loadConfiguratorQuestions() {
    const url = "Configurator-Questions.json";

    try {
        const response = await fetch(url);
        const data = await response.json();

        const b = data[0].BibeauBodyOptions;

        const fieldMap = {
            "Body-Series": b.Series,
            "Body-Length": b.BodyLength,
            "Side-Ht-F": b.SideHtF,
            "Side-Ht-R": b.SideHtR,
            "Doghouse-Depth": b.DoghouseDepth,
            "Extra-Ovals-Rear": b.ExtraOvalsRear,
            "Door-Slope": b.DoorSlope,
            "Hi-Lift-Tailgate": b[b.HiLiftTailgate],
            "Coal-Door": b[b.CoalDoor],
            "Twistlocks": b[b.Twistlocks],
            "Light-Kit": b.LightKit,

            "Bumper": b.FormulaDriven.Bumper,
            "Vibrator-Plate": b.FixedValues.VibratorPlate,
            "Inside-Steps": b.FixedValues.InsideSteps,
            "Side-Plate": b.FixedValues.SidePlate,
            "Tailgate-Cylinder": b.FixedValues.TailgateCylinder,
            "Body-Prop": b.FixedValues.BodyProp
        };

        for (let id in fieldMap) {
            const value = fieldMap[id];
            const element = document.getElementById(id);

            if (!element) continue;

            if (Array.isArray(value)) {
                element.innerHTML = "";
                value.forEach(v => {
                    const opt = document.createElement("option");
                    opt.value = v;
                    opt.textContent = v;
                    element.appendChild(opt);
                });
            } else {
                element.value = value;
            }
        }

        document.getElementById("configuratorContainer").classList.remove("hidden");

    } catch (err) {
        console.error("Error loading configurator data:", err);
        alert("Failed to load configurator data.");
    }
}
</script>

</body>
</html>
